<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®å·ç»“æœæŸ¥çœ‹ - åå°ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 
                         'Microsoft YaHei', sans-serif;
            background: linear-gradient(-45deg, #ffecd2, #fcb69f, #fbc2eb, #a6c1ee, #c2e9fb, #a1c4fd, #fbc2eb, #ffecd2);
            background-size: 400% 400%;
            animation: rainbow 45s ease-in-out infinite;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            25% { background-position: 50% 75%; }
            50% { background-position: 100% 50%; }
            75% { background-position: 50% 25%; }
            100% { background-position: 0% 50%; }
        }

        .meteor {
            position: fixed;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
            animation: meteor-fall linear;
            pointer-events: none;
            z-index: 0;
        }

        .meteor::before {
            content: '';
            position: absolute;
            top: 0;
            right: 2px;
            width: 80px;
            height: 2px;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.8), transparent);
            transform: translateX(0);
        }

        @keyframes meteor-fall {
            0% {
                transform: translate(0, 0) rotate(-45deg);
                opacity: 1;
            }
            100% {
                transform: translate(-300px, 300px) rotate(-45deg);
                opacity: 0;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .header h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #888;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 28px;
            color: #666;
            font-weight: 700;
        }

        .answers-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .answers-container h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .answer-item {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            border-left: 4px solid #a8c0ff;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .answer-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-number {
            display: inline-block;
            background: rgba(0, 0, 0, 0.06);
            color: #666;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .answer-time {
            color: #888;
            font-size: 13px;
        }

        .question-text {
            font-size: 17px;
            color: #333;
            margin-bottom: 12px;
            font-weight: 500;
            line-height: 1.6;
        }

        .answer-content {
            background: rgba(255, 255, 255, 0.8);
            padding: 18px;
            border-radius: 12px;
            margin-top: 12px;
        }

        .answer-text {
            color: #333;
            font-size: 16px;
            line-height: 1.8;
            white-space: pre-wrap;
            letter-spacing: 0.3px;
        }

        /* AIåˆ†æç»“æœæ ·å¼ */
        .analysis-result {
            background: linear-gradient(135deg, rgba(168, 192, 255, 0.1), rgba(63, 43, 150, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid #a8c0ff;
        }

        .analysis-title {
            font-size: 22px;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
        }

        .analysis-score-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .analysis-score-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a8c0ff 0%, #3f2b96 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: 700;
            box-shadow: 0 10px 30px rgba(168, 192, 255, 0.4);
        }

        .analysis-dimensions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .analysis-dim-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .analysis-dim-name {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .analysis-dim-score {
            font-size: 24px;
            color: #a8c0ff;
            font-weight: 700;
        }

        .analysis-feedback {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .analysis-feedback h4 {
            font-size: 16px;
            color: #a8c0ff;
            margin: 15px 0 10px 0;
        }

        .analysis-feedback p {
            font-size: 14px;
            color: #555;
            line-height: 1.8;
            margin: 5px 0;
        }

        .answer-meta {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            font-size: 13px;
            color: #999;
        }

        .answer-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .no-data h3 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        .no-data p {
            font-size: 16px;
            color: #999;
        }

        .export-btn {
            background: linear-gradient(135deg, #a8c0ff 0%, #3f2b96 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(168, 192, 255, 0.35);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(168, 192, 255, 0.45);
        }

        .export-btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 12px rgba(168, 192, 255, 0.3);
        }

        .type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .type-choice {
            background: #e3f2fd;
            color: #1976d2;
        }

        .type-text {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .question-header {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>é—®å·ç»“æœæŸ¥çœ‹</h1>
            <p>æŸ¥çœ‹å°å®—çš„ç­”é¢˜è¯¦æƒ…å’Œç»Ÿè®¡æ•°æ®</p>
        </div>

        <div class="stats-grid" id="statsGrid"></div>

        <div class="answers-container">
            <h2>ç­”é¢˜è¯¦æƒ…</h2>
            <div id="answersContent"></div>
            <button class="export-btn" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
        </div>
    </div>

    <script type="module">
        // Firebase é…ç½®
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBs5eWEiabOSZrP5LqQSvDeJ8L3pDjTyu8",
            authDomain: "comment-526a0.firebaseapp.com",
            databaseURL: "https://comment-526a0-default-rtdb.firebaseio.com",
            projectId: "comment-526a0",
            storageBucket: "comment-526a0.firebasestorage.app",
            messagingSenderId: "450500622985",
            appId: "1:450500622985:web:19ea2335e274de8be82458",
            measurementId: "G-N1H2NCGLGR"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // é¡µé¢åŠ è½½æ—¶å¯åŠ¨æµæ˜Ÿæ•ˆæœå’ŒåŠ è½½æ•°æ®
        window.addEventListener('DOMContentLoaded', () => {
            createMeteors();
            loadDataFromFirebase();
        });

        // åˆ›å»ºæµæ˜Ÿ
        function createMeteors() {
            setInterval(() => {
                const meteor = document.createElement('div');
                meteor.className = 'meteor';
                
                const startX = Math.random() * window.innerWidth;
                const startY = Math.random() * window.innerHeight * 0.5;
                
                meteor.style.left = startX + 'px';
                meteor.style.top = startY + 'px';
                
                const duration = 1 + Math.random();
                meteor.style.animationDuration = duration + 's';
                
                document.body.appendChild(meteor);
                
                setTimeout(() => {
                    meteor.remove();
                }, duration * 1000);
            }, 3000);
        }

        // ä» Firebase åŠ è½½æ•°æ®
        function loadDataFromFirebase() {
            const quizzesRef = ref(database, 'quizzes');
            
            onValue(quizzesRef, (snapshot) => {
                const data = snapshot.val();
                
                if (!data) {
                    document.getElementById('statsGrid').innerHTML = '';
                    document.getElementById('answersContent').innerHTML = `
                        <div class="no-data">
                            <h3>æš‚æ— æ•°æ®</h3>
                            <p>è¿˜æ²¡æœ‰äººå®Œæˆé—®å·</p>
                        </div>
                    `;
                    return;
                }

                // å°†å¯¹è±¡è½¬æ¢ä¸ºæ•°ç»„å¹¶æŒ‰æäº¤æ—¶é—´æ’åº
                const quizArray = Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })).sort((a, b) => b.submittedAt - a.submittedAt);

                displayAllQuizzes(quizArray);
            }, (error) => {
                console.error('è¯»å– Firebase æ•°æ®å¤±è´¥:', error);
                document.getElementById('answersContent').innerHTML = `
                    <div class="no-data">
                        <h3>åŠ è½½å¤±è´¥</h3>
                        <p>æ— æ³•è¿æ¥åˆ°æ•°æ®åº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
                    </div>
                `;
            });
        }

        // æ˜¾ç¤ºæ‰€æœ‰é—®å·
        function displayAllQuizzes(quizzes) {
            if (quizzes.length === 0) {
                document.getElementById('statsGrid').innerHTML = '';
                document.getElementById('answersContent').innerHTML = `
                    <div class="no-data">
                        <h3>æš‚æ— æ•°æ®</h3>
                        <p>è¿˜æ²¡æœ‰äººå®Œæˆé—®å·</p>
                    </div>
                `;
                return;
            }

            // æ˜¾ç¤ºæ€»ä½“ç»Ÿè®¡
            const totalQuizzes = quizzes.length;
            const latestQuiz = quizzes[0];
            const avgTime = Math.round(quizzes.reduce((sum, q) => sum + q.totalTimeSeconds, 0) / totalQuizzes);
            
            const statsHTML = `
                <div class="stat-card">
                    <h3>æäº¤æ¬¡æ•°</h3>
                    <div class="value">${totalQuizzes}</div>
                </div>
                <div class="stat-card">
                    <h3>æœ€æ–°æäº¤</h3>
                    <div class="value" style="font-size: 16px;">${latestQuiz.completeTime || 'æœªçŸ¥'}</div>
                </div>
                <div class="stat-card">
                    <h3>å¹³å‡ç”¨æ—¶</h3>
                    <div class="value">${formatTime(avgTime)}</div>
                </div>
                <div class="stat-card">
                    <h3>å®Œæˆç‡</h3>
                    <div class="value">100%</div>
                </div>
            `;
            document.getElementById('statsGrid').innerHTML = statsHTML;

            // æ˜¾ç¤ºæ¯æ¬¡æäº¤çš„è¯¦æƒ…
            let allAnswersHTML = '';
            quizzes.forEach((quiz, quizIndex) => {
                allAnswersHTML += `
                    <div style="margin-bottom: 50px;">
                        <h3 style="color: #666; margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 12px;">
                            æäº¤è®°å½• #${quizzes.length - quizIndex} - ${quiz.completeTime} 
                            <span style="font-size: 14px; color: #999; margin-left: 15px;">æ€»ç”¨æ—¶: ${formatTime(quiz.totalTimeSeconds)}</span>
                        </h3>
                `;
                
                // å…ˆæ˜¾ç¤ºAIåˆ†æç»“æœï¼ˆå¦‚æœæœ‰ï¼‰
                if (quiz.analysis) {
                    allAnswersHTML += '<div class="analysis-result">';
                    allAnswersHTML += '<div class="analysis-title">æ™ºèƒ½åˆ†ææŠ¥å‘Š</div>';
                    
                    // ç»¼åˆå¾—åˆ†
                    allAnswersHTML += '<div class="analysis-score-display">';
                    allAnswersHTML += `<div class="analysis-score-circle">${quiz.analysis.overallScore}<span style="font-size: 14px;">åˆ†</span></div>`;
                    allAnswersHTML += `<p style="color: #666;">${quiz.analysis.scoreDescription}</p>`;
                    allAnswersHTML += '</div>';
                    
                    // å„ç»´åº¦å¾—åˆ†
                    allAnswersHTML += '<div class="analysis-dimensions">';
                    quiz.analysis.dimensions.forEach(dim => {
                        allAnswersHTML += '<div class="analysis-dim-card">';
                        allAnswersHTML += `<div class="analysis-dim-name">${dim.name}</div>`;
                        allAnswersHTML += `<div class="analysis-dim-score">${dim.score}åˆ†</div>`;
                        allAnswersHTML += '</div>';
                    });
                    allAnswersHTML += '</div>';
                    
                    // AIåé¦ˆ
                    allAnswersHTML += '<div class="analysis-feedback">';
                    
                    if (quiz.analysis.strengths) {
                        allAnswersHTML += '<h4>é—ªå…‰ç‚¹</h4>';
                        quiz.analysis.strengths.forEach(s => {
                            allAnswersHTML += `<p>â€¢ ${s}</p>`;
                        });
                    }
                    
                    if (quiz.analysis.suggestions) {
                        allAnswersHTML += '<h4>å»ºè®®</h4>';
                        quiz.analysis.suggestions.forEach(s => {
                            allAnswersHTML += `<p>â€¢ ${s}</p>`;
                        });
                    }
                    
                    if (quiz.analysis.summary) {
                        allAnswersHTML += '<h4>ç»¼åˆè¯„ä»·</h4>';
                        allAnswersHTML += `<p>${quiz.analysis.summary}</p>`;
                    }
                    
                    if (quiz.analysis.encouragement) {
                        allAnswersHTML += '<h4>é¼“åŠ±çš„è¯</h4>';
                        allAnswersHTML += `<p>${quiz.analysis.encouragement}</p>`;
                    }
                    
                    allAnswersHTML += '</div>';
                    allAnswersHTML += '</div>';
                }
                
                quiz.answers.forEach((answer) => {
                    const typeBadge = answer.questionType === 'choice' 
                        ? '<span class="type-badge type-choice">é€‰æ‹©é¢˜</span>' 
                        : '<span class="type-badge type-text">ä¸»è§‚é¢˜</span>';
                    
                    allAnswersHTML += `
                        <div class="answer-item">
                            <div class="question-header">
                                <div>
                                    <span class="question-number">ç¬¬ ${answer.questionId} é¢˜</span>
                                    ${typeBadge}
                                </div>
                                <span class="answer-time">ç”¨æ—¶: ${answer.answerTime}ç§’</span>
                            </div>
                            <div class="question-text">${answer.questionText}</div>
                            <div class="answer-content">
                                <div class="answer-text">${
                                    answer.questionType === 'choice' 
                                        ? answer.answerText 
                                        : answer.answer
                                }</div>
                            </div>
                            <div class="answer-meta">
                                <span>â° ${new Date(answer.timestamp).toLocaleString('zh-CN')}</span>
                                <span>ğŸ“ ${answer.questionType === 'choice' ? 'é€‰é¡¹' + String.fromCharCode(65 + answer.answer) : answer.answer.length + 'å­—'}</span>
                            </div>
                        </div>
                    `;
                });
                
                allAnswersHTML += '</div>';
            });

            document.getElementById('answersContent').innerHTML = allAnswersHTML;
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}åˆ†${secs}ç§’`;
        }

        // å¯¼å‡ºæ•°æ®
        window.exportData = function() {
            const quizzesRef = ref(database, 'quizzes');
            
            onValue(quizzesRef, (snapshot) => {
                const data = snapshot.val();
                
                if (!data) {
                    alert('æ²¡æœ‰æ•°æ®å¯ä»¥å¯¼å‡º');
                    return;
                }

                const jsonStr = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `é—®å·ç»“æœ_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, { onlyOnce: true });
        }

        // Firebase å®æ—¶ç›‘å¬ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œä¸éœ€è¦å®šæ—¶åˆ·æ–°
    </script>
</body>
</html>

