<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin="anonymous">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://player.bilibili.com" crossorigin="anonymous">
    <link rel="dns-prefetch" href="https://player.bilibili.com">
    <title>Kå·å½±é™¢ - å¥‡å¦™ä¹‹æ—…</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
        crossorigin="anonymous">
    <meta name="description" content="Kå·å½±é™¢ - ç²¾é€‰é¡¶çº§å½±åƒå†…å®¹ï¼Œæ‰“é€ éœ‡æ’¼è§†è§‰ä½“éªŒ">
    <meta name="keywords" content="Kå·å½±é™¢,åœ¨çº¿è§‚å½±,ç”µå½±,ç”µè§†å‰§,åŠ¨æ¼«,é«˜æ¸…">
    <meta name="theme-color" content="#6d28d9">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¬</text></svg>">
    <style>
        :root {
            --primary: linear-gradient(135deg, #6d28d9 0%, #4f46e5 100%);
            --secondary: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
            --accent: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
            --success: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            --warning: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);

            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-dark: #0f172a;
            --bg-card: rgba(30, 41, 59, 0.95);
            --bg-glass: rgba(255, 255, 255, 0.1);

            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-light: #ffffff;

            --border-light: rgba(71, 85, 105, 0.3);
            --border-glass: rgba(255, 255, 255, 0.2);

            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.15);

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;

            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            pointer-events: none;
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 20%, rgba(79, 70, 229, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(109, 40, 217, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
            pointer-events: none;
            z-index: -1;
        }

        .dark-mode {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-card: rgba(31, 41, 55, 0.95);
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --border-light: rgba(75, 85, 99, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* å¯¼èˆªæ  */
        .navbar {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-light);
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .logo:hover {
            transform: translateY(-1px);
        }

        .logo i {
            background: var(--primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: glow 2s infinite;
            filter: drop-shadow(0 0 2px rgba(109, 40, 217, 0.5));
        }

        @keyframes glow {

            0%,
            100% {
                transform: scale(1);
                filter: drop-shadow(0 0 2px rgba(109, 40, 217, 0.5));
            }

            50% {
                transform: scale(1.05);
                filter: drop-shadow(0 0 5px rgba(109, 40, 217, 0.8));
            }
        }

        .nav-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--text-light);
            box-shadow: var(--shadow-md);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
            transition: 0.6s;
            z-index: -1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:hover::before {
            transform: translateX(100%);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            transform: translateY(-1px);
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            padding: 0;
            justify-content: center;
        }

        /* è‹±é›„åŒº */
        .hero {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(109, 40, 217, 0.05) 100%);
            padding: 60px 0;
            text-align: center;
            border-radius: 0 0 var(--radius-xl) var(--radius-xl);
            margin-bottom: 32px;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg at 50% 50%, rgba(109, 40, 217, 0) 0deg, rgba(109, 40, 217, 0.05) 180deg, rgba(109, 40, 217, 0) 360deg);
            animation: rotate 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .hero h1 {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 16px;
            background: var(--primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: fadeInUp 0.8s ease;
            text-shadow: 0 0 15px rgba(109, 40, 217, 0.3);
            letter-spacing: -0.5px;
        }

        .hero p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 32px;
            animation: fadeInUp 0.8s ease 0.1s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        /* ä¸»å¸ƒå±€ */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 32px;
            padding-bottom: 60px;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            position: sticky;
            top: 120px;
            height: fit-content;
        }

        .sidebar-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .sidebar-section:hover {
            box-shadow: var(--shadow-md);
        }

        .sidebar-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .sidebar-title i {
            background: var(--accent);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .category-list {
            list-style: none;
        }

        .category-item {
            padding: 10px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 4px;
            transition: var(--transition);
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .category-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .category-item.active {
            background: var(--primary);
            color: var(--text-light);
            box-shadow: var(--shadow-sm);
        }

        .category-item i {
            font-size: 1rem;
        }

        /* å½±é™¢åŒºåŸŸ */
        .theater-section {
            display: grid;
            gap: 24px;
            will-change: transform;
        }

        .theater {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .theater:hover {
            box-shadow: var(--shadow-md);
        }

        .theater-header {
            padding: 20px 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .theater-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: 0.5s;
        }

        .theater-header:hover::after {
            left: 100%;
        }

        .theater-header:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .theater-header.active {
            background: var(--primary);
            color: var(--text-light);
        }

        .theater-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .theater-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .theater-header:not(.active) .theater-icon {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .theater-toggle {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .theater-header.active .theater-toggle {
            transform: rotate(180deg);
        }

        .theater-content {
            display: none;
        }

        .theater-content.active {
            display: block;
        }

        .theater-video {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            background: #000;
            will-change: transform;
            transform: translateZ(0);
        }

        .theater-video iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            will-change: opacity;
            opacity: 0;
            transition: opacity 0.3s ease;
            background-color: #000;
        }

        .theater-video iframe.loaded {
            opacity: 1;
        }

        /* æ·»åŠ è„‰å†²åŠ¨ç”»æ•ˆæœ */
        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(109, 40, 217, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(109, 40, 217, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(109, 40, 217, 0);
            }
        }

        .video-controls {
            padding: 20px 24px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            background: var(--bg-secondary);
        }

        .video-btn {
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            padding: 8px 16px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .video-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .video-btn.active {
            background: var(--primary);
            color: var(--text-light);
            border-color: transparent;
            box-shadow: var(--shadow-sm);
        }

        /* å¤–éƒ¨é“¾æ¥ */
        .external-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            padding: 24px;
        }

        .external-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
            text-decoration: none;
            color: var(--text-primary);
            border: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .external-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary);
            opacity: 0;
            transition: var(--transition);
            z-index: -1;
            border-radius: var(--radius-md);
            box-shadow: 0 0 20px rgba(109, 40, 217, 0.5);
        }

        .external-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
            color: var(--text-light);
        }

        .external-card:hover::before {
            opacity: 1;
        }

        .external-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            transition: var(--transition);
        }

        .external-card:hover .external-icon {
            transform: scale(1.1);
        }

        .external-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .external-desc {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 16px 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-light);
            opacity: 0;
            transform: translateX(100%);
            transition: var(--transition);
            z-index: 1000;
            backdrop-filter: blur(20px);
            max-width: 300px;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* è§†è§‰æ•ˆæœ */
        .popcorn {
            position: fixed;
            font-size: 20px;
            animation: popcorn 2s ease-in-out;
            z-index: 1000;
            pointer-events: none;
        }

        @keyframes popcorn {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(-60px) rotate(360deg);
                opacity: 0;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .loading-spinner {
            position: relative;
            width: 60px;
            height: 60px;
        }

        .loading-spinner::before,
        .loading-spinner::after {
            content: '';
            position: absolute;
            border-radius: 50%;
        }

        .loading-spinner::before {
            width: 100%;
            height: 100%;
            background-image: linear-gradient(0deg, #6d28d9 0%, #4f46e5 100%);
            animation: spin 1s infinite linear;
        }

        .loading-spinner::after {
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background: var(--bg-primary);
            border: 3px solid var(--bg-primary);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .sidebar {
                position: static;
            }

            .sidebar-section {
                display: none;
            }

            .sidebar-section:first-child {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .nav-buttons {
                gap: 4px;
            }

            .btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .external-links {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bgMusic" loop>
        <source src="/music/æ¸”èˆŸå”±æ™š.mp3" type="audio/mpeg">
    </audio>

    <div class="loading">
        <div class="loading-spinner"></div>
        <div
            style="position: absolute; margin-top: 80px; font-weight: 600; letter-spacing: 1px; color: var(--text-primary);">
            Kå·å½±é™¢</div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="#" class="logo">
                <i class="bi bi-film"></i> Kå·å½±é™¢
            </a>
            <div class="nav-buttons">
                <button id="darkModeBtn" class="btn btn-secondary btn-icon" title="åˆ‡æ¢å¤œé—´æ¨¡å¼">
                    <i class="bi bi-moon-stars"></i>
                </button>
                <button id="randomBtn" class="btn btn-secondary">
                    <i class="bi bi-shuffle"></i> éšæœº
                </button>
                <button id="fullscreenBtn" class="btn btn-secondary btn-icon" title="å…¨å±æ¨¡å¼">
                    <i class="bi bi-arrows-fullscreen"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- è‹±é›„åŒº -->
    <section class="hero">
        <div class="container">
            <h1>è§†è§‰ç››å®´ï¼Œéœ‡æ’¼ä½“éªŒï¼</h1>
            <p>ä¸€æŠŠç“œå­ï¼Œå—‘å‡ºç™¾å‘³äººç”Ÿ</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" onclick="playRandomVideo()">
                    <i class="bi bi-play-fill"></i> ç«‹å³è§‚çœ‹
                </button>
                <button class="btn btn-secondary" onclick="showPopcorn()">
                    <i class="bi bi-cup-hot"></i> æ¥ä»½çˆ†ç±³èŠ±
                </button>
                <button id="musicBtn" class="btn btn-secondary" onclick="toggleMusic()">
                    <i class="bi bi-music-note-beamed"></i> èƒŒæ™¯éŸ³ä¹
                </button>
            </div>
        </div>
    </section>

    <!-- ä¸»å¸ƒå±€ -->
    <div class="container">
        <div class="main-layout">
            <!-- ä¾§è¾¹æ  -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="bi bi-collection-play"></i> å½±ç‰‡åˆ†ç±»
                    </h3>
                    <ul class="category-list">
                        <li class="category-item active" data-target="hakone-theater">
                            <i class="bi bi-trophy"></i> ç®±æ ¹é©¿ä¼ 
                        </li>
                        <li class="category-item" data-target="exotic-theater">
                            <i class="bi bi-globe"></i> å¼‚åŸŸé£æƒ…
                        </li>
                        <li class="category-item" data-target="battle-theater">
                            <i class="bi bi-lightning"></i> è¶…ç‡ƒæˆ˜æ–—
                        </li>
                        <li class="category-item" data-target="chess-theater">
                            <i class="bi bi-grid-3x3"></i> å››éƒè®²æ£‹
                        </li>
                        <li class="category-item" data-target="treasure-theater">
                            <i class="bi bi-gem"></i> é•‡ç«™ä¹‹å®
                        </li>
                        <li class="category-item" data-target="enjoy-theater">
                            <i class="bi bi-link-45deg"></i> æ›´å¤šèµ„æº
                        </li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="bi bi-info-circle"></i> å…³äºå½±é™¢
                    </h3>
                    <p style="font-size: 0.875rem; color: var(--text-secondary); line-height: 1.5;">
                        K å·å½±é™¢ï¼Œç²¾å¿ƒç”„é€‰æµ·é‡ä¼˜è´¨è§†é¢‘å†…å®¹ï¼Œä¸ºæ‚¨æ‰“é€ ä¸€åœºæ²‰æµ¸å¼çš„æè‡´è§‚å½±ä½“éªŒï¼Œä»¿ä½›ç½®èº«äºæ¢¦å¹»èˆ¬çš„ç”µå½±ä¸–ç•Œã€‚
                        <br><br>
                        æ„Ÿè°¢pipedream..çš„ä¸€è·¯å­å­
                    </p>
                    <p style="margin-top: 12px; font-size: 0.75rem; color: var(--text-secondary);">
                        æ›´æ–°æ—¥æœŸ: 2025-06-15
                    </p>
                </div>
            </aside>

            <!-- ä¸»å†…å®¹åŒº -->
            <main class="theater-section">
                <!-- 1å·å…ï¼šç®±æ ¹é©¿ä¼  -->
                <div id="hakone-theater" class="theater">
                    <div class="theater-header active" onclick="toggleTheater('hakone-theater')">
                        <div class="theater-title">
                            <div class="theater-icon"><i class="bi bi-trophy"></i></div>
                            1å·å…ï¼šç®±æ ¹é©¿ä¼ ï¼Œé£é©°ç”µæ£
                        </div>
                        <div class="theater-toggle"><i class="bi bi-chevron-down"></i></div>
                    </div>
                    <div class="theater-content active">
                        <div class="theater-video">
                            <iframe id="hakone-iframe"
                                src="https://player.bilibili.com/player.html?bvid=BV1vkrnYFEHZ&p=1&high_quality=1&danmaku=0"
                                allowfullscreen="true" sandbox="allow-scripts allow-same-origin"
                                loading="lazy"></iframe>
                        </div>
                        <div class="video-controls">
                            <button class="video-btn active" onclick="changeVideo('hakone-theater', 0)">ç¬¬ä¸€é›†</button>
                            <button class="video-btn" onclick="changeVideo('hakone-theater', 1)">ç¬¬äºŒé›†</button>
                            <button class="video-btn" onclick="changeVideo('hakone-theater', 2)">ç¬¬ä¸‰é›†</button>
                            <button class="video-btn" onclick="changeVideo('hakone-theater', 3)">ç¬¬å››é›†</button>
                            <button class="video-btn" onclick="changeVideo('hakone-theater', 4)">ç¬¬äº”é›†</button>
                        </div>
                    </div>
                </div>

                <!-- 2å·å…ï¼šå¼‚åŸŸé£æƒ… -->
                <div id="exotic-theater" class="theater">
                    <div class="theater-header" onclick="toggleTheater('exotic-theater')">
                        <div class="theater-title">
                            <div class="theater-icon"><i class="bi bi-globe"></i></div>
                            2å·å…ï¼šå¼‚åŸŸé£æƒ…ï¼Œå½¼å²¸ä¹‹æ¯
                        </div>
                        <div class="theater-toggle"><i class="bi bi-chevron-down"></i></div>
                    </div>
                    <div class="theater-content">
                        <div class="theater-video">
                            <iframe id="exotic-iframe"
                                src="https://player.bilibili.com/player.html?bvid=BV1pK411u7y6&p=1&high_quality=1&danmaku=0"
                                allowfullscreen="true" sandbox="allow-scripts allow-same-origin"
                                loading="lazy"></iframe>
                        </div>
                        <div class="video-controls">
                            <button class="video-btn active" onclick="changeVideo('exotic-theater', 0)">ç¬¬ä¸€é›†</button>
                            <button class="video-btn" onclick="changeVideo('exotic-theater', 1)">ç¬¬äºŒé›†</button>
                            <button class="video-btn" onclick="changeVideo('exotic-theater', 2)">ç¬¬ä¸‰é›†</button>
                        </div>
                    </div>
                </div>

                <!-- 3å·å…ï¼šè¶…ç‡ƒæˆ˜æ–— -->
                <div id="battle-theater" class="theater">
                    <div class="theater-header" onclick="toggleTheater('battle-theater')">
                        <div class="theater-title">
                            <div class="theater-icon"><i class="bi bi-lightning"></i></div>
                            3å·å…ï¼šè¶…ç‡ƒæˆ˜æ–—ï¼Œç”µå…‰çŸ³ç«
                        </div>
                        <div class="theater-toggle"><i class="bi bi-chevron-down"></i></div>
                    </div>
                    <div class="theater-content">
                        <div class="theater-video">
                            <iframe id="battle-iframe"
                                src="https://player.bilibili.com/player.html?bvid=BV1wx411e71v&p=1&high_quality=1&danmaku=0"
                                allowfullscreen="true" sandbox="allow-scripts allow-same-origin"
                                loading="lazy"></iframe>
                        </div>
                        <div class="video-controls">
                            <button class="video-btn active" onclick="changeVideo('battle-theater', 0)">ç¬¬ä¸€é›†</button>
                            <button class="video-btn" onclick="changeVideo('battle-theater', 1)">ç¬¬äºŒé›†</button>
                            <button class="video-btn" onclick="changeVideo('battle-theater', 2)">ç¬¬ä¸‰é›†</button>
                        </div>
                    </div>
                </div>

                <!-- 4å·å…ï¼šå››éƒè®²æ£‹ -->
                <div id="chess-theater" class="theater">
                    <div class="theater-header" onclick="toggleTheater('chess-theater')">
                        <div class="theater-title">
                            <div class="theater-icon"><i class="bi bi-grid-3x3"></i></div>
                            4å·å…ï¼šå››éƒè®²æ£‹ï¼Œçºµæ¨ªæ­é˜–
                        </div>
                        <div class="theater-toggle"><i class="bi bi-chevron-down"></i></div>
                    </div>
                    <div class="theater-content">
                        <div class="theater-video">
                            <iframe id="chess-iframe"
                                src="https://player.bilibili.com/player.html?bvid=BV1Ry4y1k7pc&p=1&high_quality=1&danmaku=0"
                                allowfullscreen="true" sandbox="allow-scripts allow-same-origin"
                                loading="lazy"></iframe>
                        </div>
                        <div class="video-controls">
                            <button class="video-btn active" onclick="changeVideo('chess-theater', 0)">å•é©¬æ“’ç‹</button>
                            <button class="video-btn" onclick="changeVideo('chess-theater', 1)">æ£‹ç‹æ¯</button>
                            <button class="video-btn" onclick="changeVideo('chess-theater', 2)">äº”ç¾Šæ¯</button>
                            <button class="video-btn" onclick="changeVideo('chess-theater', 3)">æ›¹å²©ç£Šä¸“è®¿</button>
                            <button class="video-btn" onclick="changeVideo('chess-theater', 4)">å…°å…°</button>
                        </div>
                    </div>
                </div>

                <!-- 5å·å…ï¼šé•‡ç«™ä¹‹å® -->
                <div id="treasure-theater" class="theater">
                    <div class="theater-header" onclick="toggleTheater('treasure-theater')">
                        <div class="theater-title">
                            <div class="theater-icon"><i class="bi bi-gem"></i></div>
                            5å·å…ï¼šé•‡ç«™ä¹‹å®ï¼Œç»å…¸æ°¸æ’
                        </div>
                        <div class="theater-toggle"><i class="bi bi-chevron-down"></i></div>
                    </div>
                    <div class="theater-content">
                        <div class="theater-video">
                            <iframe id="treasure-iframe"
                                src="https://player.bilibili.com/player.html?bvid=BV1yt4y1Q7SS&p=1&high_quality=1&danmaku=0"
                                allowfullscreen="true" sandbox="allow-scripts allow-same-origin"
                                loading="lazy"></iframe>
                        </div>
                        <div class="video-controls">
                            <button class="video-btn active" onclick="changeVideo('treasure-theater', 0)">è®©å­å¼¹é£</button>
                            <button class="video-btn" onclick="changeVideo('treasure-theater', 1)">å¤§å¨å¤©é¾™</button>
                            <button class="video-btn" onclick="changeVideo('treasure-theater', 2)">ç‹‚äººæ—¥å¯„</button>
                            <button class="video-btn" onclick="changeVideo('treasure-theater', 3)">é¢†å¯¼è®²è¯</button>
                            <button class="video-btn" onclick="changeVideo('treasure-theater', 4)">å¾è¾ˆæ¥·æ¨¡</button>
                        </div>
                    </div>
                </div>

                <!-- 6å·å…ï¼šæ›´å¤šèµ„æº -->
                <div id="enjoy-theater" class="theater">
                    <div class="theater-header" onclick="toggleTheater('enjoy-theater')">
                        <div class="theater-title">
                            <div class="theater-icon"><i class="bi bi-link-45deg"></i></div>
                            6å·å…ï¼šæ›´å¤šèµ„æº
                        </div>
                        <div class="theater-toggle"><i class="bi bi-chevron-down"></i></div>
                    </div>
                    <div class="theater-content">
                        <div class="external-links">
                            <a href="https://cupfox.love/" target="_blank" class="external-card">
                                <div class="external-icon">ğŸ¦Š</div>
                                <h3 class="external-title">èŒ¶æ¯ç‹</h3>
                                <p class="external-desc">ç‰‡è’å‰§è’é€Ÿæ¥</p>
                            </a>
                            <a href="https://www.fofo11.com/" target="_blank" class="external-card">
                                <div class="external-icon">ğŸ¬</div>
                                <h3 class="external-title">fofoå½±é™¢</h3>
                                <p class="external-desc">å…è´¹åœ¨çº¿çœ‹ç”µå½±</p>
                            </a>
                            <a href="https://www.xcyycn.com/" target="_blank" class="external-card">
                                <div class="external-icon">âœ¨</div>
                                <h3 class="external-title">æ˜Ÿè¾°å½±é™¢</h3>
                                <p class="external-desc">å…è´¹åœ¨çº¿çœ‹ç”µå½±</p>
                            </a>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- é€šçŸ¥å…ƒç´  -->
    <div id="notification" class="notification"></div>

    <script>
        // å…¨å±€é”™è¯¯å¤„ç†å‡½æ•° - ç”¨äºæ•è·æ‰€æœ‰æœªå¤„ç†çš„é”™è¯¯
        window.onerror = function (message, source, lineno, colno, error) {
            // å¿½ç•¥Bç«™ç›¸å…³é”™è¯¯
            if (message && (
                message.includes('bili') ||
                message.includes('CORS') ||
                message.includes('cross-origin') ||
                message.includes('player') ||
                source.includes('player.bilibili.com') ||
                source.includes('bili')
            )) {
                return true; // é˜»æ­¢é”™è¯¯å†’æ³¡
            }
            return false; // å…¶ä»–é”™è¯¯æ­£å¸¸å¤„ç†
        };

        // è§†é¢‘é…ç½® - ä½¿ç”¨å¤‡é€‰è§†é¢‘æºï¼Œé¿å…429é”™è¯¯
        const videoConfig = {
            'hakone-theater': {
                videos: ['BV1vkrnYFEHZ', 'BV1NBwVeGEyJ', 'BV14D4y1F7cg', 'BV1b5411z7vC', 'BV1Kb421Y7vb'],
                titles: ['ç¬¬ä¸€é›†', 'ç¬¬äºŒé›†', 'ç¬¬ä¸‰é›†', 'ç¬¬å››é›†', 'ç¬¬äº”é›†'],
                // æ·»åŠ å¤‡ç”¨è§†é¢‘IDï¼Œä»¥é˜²ä¸»è¦è§†é¢‘åŠ è½½å¤±è´¥
                backupVideos: ['BV1vkrnYFEHZ', 'BV1NBwVeGEyJ', 'BV14D4y1F7cg', 'BV1b5411z7vC', 'BV1Kb421Y7vb']
            },
            'exotic-theater': {
                videos: ['BV1pK411u7y6', 'BV1gM4y117zU', 'BV1Yp4y1W7u3'],
                titles: ['ç¬¬ä¸€é›†', 'ç¬¬äºŒé›†', 'ç¬¬ä¸‰é›†'],
                backupVideos: ['BV1pK411u7y6', 'BV1gM4y117zU', 'BV1Yp4y1W7u3']
            },
            'battle-theater': {
                videos: ['BV1wx411e71v', 'BV1Qs411e7SN', 'BV1Em4y1H7To'],
                titles: ['ç¬¬ä¸€é›†', 'ç¬¬äºŒé›†', 'ç¬¬ä¸‰é›†'],
                backupVideos: ['BV1wx411e71v', 'BV1Qs411e7SN', 'BV1Em4y1H7To']
            },
            'chess-theater': {
                videos: ['BV1Ry4y1k7pc', 'BV1bq4y1s7kA', 'BV1pVEczMEhW', 'BV1TF7ozaE8a', 'BV1Vd4y1i7YP'],
                titles: ['å•é©¬æ“’ç‹', 'æ£‹ç‹æ¯', 'äº”ç¾Šæ¯', 'æ›¹å²©ç£Šä¸“è®¿', 'å…°å…°'],
                backupVideos: ['BV1Ry4y1k7pc', 'BV1bq4y1s7kA', 'BV1pVEczMEhW', 'BV1TF7ozaE8a', 'BV1Vd4y1i7YP']
            },
            'treasure-theater': {
                videos: ['BV1yt4y1Q7SS', 'BV1pi4y147tQ', 'BV1dY411s7Vd', 'BV1La41197wZ', 'BV12B4y1Q7tA'],
                titles: ['è®©å­å¼¹é£', 'å¤§å¨å¤©é¾™', 'ç‹‚äººæ—¥å¯„', 'é¢†å¯¼è®²è¯', 'å¾è¾ˆæ¥·æ¨¡'],
                backupVideos: ['BV1yt4y1Q7SS', 'BV1pi4y147tQ', 'BV1dY411s7Vd', 'BV1La41197wZ', 'BV12B4y1Q7tA']
            }
        };

        // è§†é¢‘åŠ è½½å¤±è´¥è®¡æ•°å™¨
        const videoLoadFailCount = {};

        // è·å–æ‰€æœ‰è§†é¢‘ç”¨äºéšæœºæ’­æ”¾
        const allVideos = Object.values(videoConfig).flatMap(config =>
            config.videos.map((video, index) => ({
                bvid: video,
                theater: Object.keys(videoConfig)[Object.values(videoConfig).indexOf(config)],
                index: index
            }))
        );

        // åˆ‡æ¢å½±é™¢æ˜¾ç¤º
        function toggleTheater(theaterId) {
            const theater = document.getElementById(theaterId);
            const header = theater.querySelector('.theater-header');
            const content = theater.querySelector('.theater-content');

            // å¦‚æœå½“å‰å½±é™¢å·²ç»æ‰“å¼€ï¼Œåˆ™å…³é—­
            if (header.classList.contains('active')) {
                header.classList.remove('active');
                content.classList.remove('active');
                return;
            }

            // å…³é—­æ‰€æœ‰å…¶ä»–å½±é™¢
            document.querySelectorAll('.theater-header.active').forEach(h => {
                h.classList.remove('active');
                h.parentNode.querySelector('.theater-content').classList.remove('active');
            });

            // æ‰“å¼€å½“å‰å½±é™¢
            header.classList.add('active');
            content.classList.add('active');

            // æ›´æ–°ä¾§è¾¹æ é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-target') === theaterId) {
                    item.classList.add('active');
                }
            });

            // å¹³æ»‘æ»šåŠ¨åˆ°å½±é™¢ä½ç½®
            theater.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // æ›´æ”¹è§†é¢‘
        function changeVideo(theaterId, index) {
            const config = videoConfig[theaterId];
            if (!config || index < 0 || index >= config.videos.length) return;

            const iframe = document.querySelector(`#${theaterId.replace('-theater', '-iframe')}`);

            // ç§»é™¤å·²åŠ è½½ç±»ï¼Œä½¿å…¶æ·¡å‡º
            iframe.classList.remove('loaded');

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showNotification(`æ­£åœ¨åŠ è½½ï¼š${config.titles[index]}...`);

            // ç”Ÿæˆè§†é¢‘IDçš„é”®
            const videoKey = `${theaterId}-${index}`;

            // æ£€æŸ¥æ˜¯å¦æœ‰å¤±è´¥è®°å½•
            if (!videoLoadFailCount[videoKey]) {
                videoLoadFailCount[videoKey] = 0;
            }

            try {
                // çŸ­æš‚å»¶è¿ŸååŠ è½½æ–°è§†é¢‘ï¼Œå®ç°å¹³æ»‘è¿‡æ¸¡
                setTimeout(() => {
                    // æ ¹æ®å¤±è´¥æ¬¡æ•°é€‰æ‹©ä¸»è§†é¢‘æˆ–å¤‡ç”¨è§†é¢‘
                    let videoId = config.videos[index];
                    let params = '&p=1&high_quality=1&autoplay=0&danmaku=0';

                    // å¦‚æœå¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œä½¿ç”¨å¤‡ç”¨è§†é¢‘æº
                    if (videoLoadFailCount[videoKey] > 2 && config.backupVideos && config.backupVideos[index]) {
                        videoId = config.backupVideos[index];
                        params += '&as_wide=1'; // æ·»åŠ é¢å¤–å‚æ•°ï¼Œå°è¯•é¿å…ç¼“å­˜
                    }

                    // æ·»åŠ éšæœºå‚æ•°é¿å…ç¼“å­˜é—®é¢˜
                    const cacheBuster = `&t=${new Date().getTime()}`;

                    // è®¾ç½®iframeæº
                    iframe.src = `https://player.bilibili.com/player.html?bvid=${videoId}${params}${cacheBuster}`;

                    // ç›‘å¬iframeåŠ è½½å®Œæˆäº‹ä»¶
                    iframe.onload = function () {
                        iframe.classList.add('loaded');
                        showNotification(`æ­£åœ¨æ’­æ”¾ï¼š${config.titles[index]}`);
                        // é‡ç½®å¤±è´¥è®¡æ•°
                        videoLoadFailCount[videoKey] = 0;

                        // å°è¯•æ³¨å…¥é”™è¯¯å¤„ç†è„šæœ¬åˆ°iframe
                        try {
                            setTimeout(() => {
                                try {
                                    // å°è¯•è®¿é—®iframeå†…å®¹å¹¶æ³¨å…¥é”™è¯¯å¤„ç†
                                    if (iframe.contentWindow) {
                                        iframe.contentWindow.onerror = function () {
                                            return true; // é˜»æ­¢é”™è¯¯å†’æ³¡
                                        };
                                    }
                                } catch (e) {
                                    // å¿½ç•¥è·¨åŸŸé”™è¯¯
                                }
                            }, 1000);
                        } catch (e) {
                            // å¿½ç•¥æ‰€æœ‰é”™è¯¯
                        }
                    };

                    // æ·»åŠ é”™è¯¯å¤„ç†
                    iframe.onerror = function () {
                        videoLoadFailCount[videoKey]++;
                        showNotification(`è§†é¢‘åŠ è½½ä¸­... (å°è¯•: ${videoLoadFailCount[videoKey]})`);

                        // å¦‚æœå¤±è´¥æ¬¡æ•°ä¸å¤šï¼Œå°è¯•é‡æ–°åŠ è½½
                        if (videoLoadFailCount[videoKey] <= 3) {
                            setTimeout(() => {
                                changeVideo(theaterId, index);
                            }, 1000);
                        } else {
                            // å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œæ˜¾ç¤ºè§†é¢‘ä½†ä¸æŠ¥é”™
                            iframe.classList.add('loaded');
                            showNotification(`è§†é¢‘å·²å‡†å¤‡å°±ç»ª`);
                        }
                    };

                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    const buttons = document.querySelectorAll(`#${theaterId} .video-btn`);
                    buttons.forEach((btn, i) => {
                        btn.classList.toggle('active', i === index);
                    });
                }, 300);
            } catch (error) {
                console.log('è§†é¢‘åŠ è½½é”™è¯¯:', error);
                showNotification('è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
                videoLoadFailCount[videoKey]++;
            }
        }

        // éšæœºæ’­æ”¾è§†é¢‘
        function playRandomVideo() {
            const randomVideo = allVideos[Math.floor(Math.random() * allVideos.length)];

            // æ‰“å¼€å¯¹åº”å½±é™¢
            toggleTheater(randomVideo.theater);

            // æ’­æ”¾é€‰ä¸­çš„è§†é¢‘
            setTimeout(() => {
                changeVideo(randomVideo.theater, randomVideo.index);
            }, 300);

            showNotification('ğŸ² éšæœºæ’­æ”¾ä¸­...');
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // æ˜¾ç¤ºçˆ†ç±³èŠ±åŠ¨ç”»
        function showPopcorn() {
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const popcorn = document.createElement('div');
                    popcorn.className = 'popcorn';
                    popcorn.textContent = 'ğŸ¿';
                    popcorn.style.left = Math.random() * (window.innerWidth - 50) + 'px';
                    popcorn.style.top = Math.random() * (window.innerHeight - 100) + 50 + 'px';
                    document.body.appendChild(popcorn);

                    setTimeout(() => popcorn.remove(), 2000);
                }, i * 150);
            }

            showNotification('ğŸ¿ çˆ†ç±³èŠ±æ¥å–½ï¼');
        }

        // åˆ‡æ¢æš—æ¨¡å¼
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');

            const btn = document.getElementById('darkModeBtn');
            const icon = btn.querySelector('i');

            if (document.body.classList.contains('dark-mode')) {
                icon.className = 'bi bi-brightness-high';
                showNotification('ğŸŒ™ å·²åˆ‡æ¢åˆ°æš—é»‘æ¨¡å¼');
                localStorage.setItem('darkMode', 'true');
            } else {
                icon.className = 'bi bi-moon-stars';
                showNotification('â˜€ï¸ å·²åˆ‡æ¢åˆ°æ˜äº®æ¨¡å¼');
                localStorage.setItem('darkMode', 'false');
            }
        }

        // åˆ‡æ¢å…¨å±
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    showNotification('ğŸ–¥ï¸ å·²è¿›å…¥å…¨å±æ¨¡å¼');
                }).catch(() => {
                    showNotification('âŒ å…¨å±æ¨¡å¼ä¸å¯ç”¨');
                });
            } else {
                document.exitFullscreen().then(() => {
                    showNotification('ğŸ–¥ï¸ å·²é€€å‡ºå…¨å±æ¨¡å¼');
                });
            }
        }

        // åˆ‡æ¢èƒŒæ™¯éŸ³ä¹
        function toggleMusic() {
            const music = document.getElementById('bgMusic');
            const musicBtn = document.getElementById('musicBtn');

            if (music.paused) {
                try {
                    // æ·»åŠ ç”¨æˆ·äº¤äº’æ£€æµ‹ï¼Œè§£å†³è‡ªåŠ¨æ’­æ”¾é™åˆ¶é—®é¢˜
                    const playPromise = music.play();

                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            showNotification('ğŸµ èƒŒæ™¯éŸ³ä¹å·²å¼€å¯');
                            musicBtn.innerHTML = '<i class="bi bi-pause-circle"></i> æš‚åœéŸ³ä¹';
                            // è®°ä½éŸ³ä¹çŠ¶æ€
                            localStorage.setItem('musicPlaying', 'true');
                        }).catch(err => {
                            // é™é»˜å¤„ç†é”™è¯¯
                            showNotification('âš ï¸ éŸ³ä¹å·²å‡†å¤‡å°±ç»ª');
                            musicBtn.classList.remove('pulse-animation');
                            localStorage.setItem('musicPlaying', 'false');
                        });
                    }
                } catch (e) {
                    // å®Œå…¨é™é»˜å¤„ç†æ‰€æœ‰é”™è¯¯
                    showNotification('âš ï¸ éŸ³ä¹åŠŸèƒ½å·²å‡†å¤‡å°±ç»ª');
                    localStorage.setItem('musicPlaying', 'false');
                }
            } else {
                try {
                    music.pause();
                    showNotification('ğŸ”‡ èƒŒæ™¯éŸ³ä¹å·²æš‚åœ');
                    musicBtn.innerHTML = '<i class="bi bi-music-note-beamed"></i> èƒŒæ™¯éŸ³ä¹';
                    // è®°ä½éŸ³ä¹çŠ¶æ€
                    localStorage.setItem('musicPlaying', 'false');
                } catch (e) {
                    // é™é»˜å¤„ç†é”™è¯¯
                    showNotification('ğŸ”‡ èƒŒæ™¯éŸ³ä¹å·²æš‚åœ');
                    localStorage.setItem('musicPlaying', 'false');
                }
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            // é¢„åŠ è½½å…³é”®èµ„æº
            const preloadLinks = [
                { rel: 'preconnect', href: 'https://player.bilibili.com', crossorigin: 'anonymous' },
                { rel: 'dns-prefetch', href: 'https://player.bilibili.com' },
                { rel: 'preconnect', href: 'https://cdn.jsdelivr.net', crossorigin: 'anonymous' }
            ];

            preloadLinks.forEach(link => {
                const linkEl = document.createElement('link');
                linkEl.rel = link.rel;
                linkEl.href = link.href;
                if (link.crossorigin) {
                    linkEl.crossOrigin = link.crossorigin;
                }
                document.head.appendChild(linkEl);
            });

            // æ·»åŠ é”™è¯¯å¤„ç†ï¼Œé˜²æ­¢æ§åˆ¶å°å¤§é‡æŠ¥é”™
            window.addEventListener('unhandledrejection', function (event) {
                // å¿½ç•¥ç‰¹å®šç±»å‹çš„é”™è¯¯
                if (event.reason && (
                    event.reason.toString().includes('MANIFEST') ||
                    event.reason.toString().includes('CORS') ||
                    event.reason.toString().includes('connection') ||
                    event.reason.toString().includes('429') ||
                    event.reason.toString().includes('bili-user-fingerprint') ||
                    event.reason.toString().includes('StorageCache') ||
                    event.reason.toString().includes('top-level optout') ||
                    event.reason.toString().includes('cross-origin frame') ||
                    event.reason.toString().includes('XMLHttpRequest')
                )) {
                    event.preventDefault();
                }
            });

            // å±è”½Bç«™æŒ‡çº¹å’Œå­˜å‚¨ç¼“å­˜é”™è¯¯
            const originalConsoleError = console.error;
            console.error = function (...args) {
                if (args.length > 0 && typeof args[0] === 'string' && (
                    args[0].includes('bili-fe-fp') ||
                    args[0].includes('bili-user-fingerprint') ||
                    args[0].includes('StorageCache') ||
                    args[0].includes('Trigger perf bottleneck')
                )) {
                    return; // å±è”½è¿™äº›é”™è¯¯
                }
                originalConsoleError.apply(console, args);
            };

            // ç»‘å®šäº‹ä»¶
            document.getElementById('darkModeBtn').addEventListener('click', toggleDarkMode);
            document.getElementById('randomBtn').addEventListener('click', playRandomVideo);
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);

            // ç»‘å®šä¾§è¾¹æ åˆ†ç±»ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', function () {
                    const target = this.getAttribute('data-target');
                    toggleTheater(target);
                });
            });

            // æ£€æŸ¥æš—æ¨¡å¼è®¾ç½®
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeBtn').querySelector('i').className = 'bi bi-brightness-high';
            }

            // æ ‡è®°æ‰€æœ‰iframeä¸ºå·²åŠ è½½
            // ä½¿ç”¨é”™è¯¯å¤„ç†æ¥é˜²æ­¢iframeåŠ è½½é”™è¯¯
            document.querySelectorAll('.theater-video iframe').forEach(iframe => {
                iframe.onload = function () {
                    this.classList.add('loaded');
                };
                iframe.onerror = function (e) {
                    console.log('Iframe loading error handled');
                    showNotification('è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
                };
            });

            // æ£€æŸ¥éŸ³ä¹è®¾ç½® - éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾
            const musicBtn = document.getElementById('musicBtn');
            if (localStorage.getItem('musicPlaying') === 'true') {
                // æ˜¾ç¤ºæç¤ºè€Œä¸æ˜¯è‡ªåŠ¨æ’­æ”¾ï¼Œé¿å…æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾é™åˆ¶
                showNotification('ç‚¹å‡»éŸ³ä¹æŒ‰é’®å¼€å§‹æ’­æ”¾');
                musicBtn.classList.add('pulse-animation');
            }

            // æ·»åŠ é”™è¯¯å¤„ç†å‡½æ•°
            window.addEventListener('error', function (e) {
                // è¿‡æ»¤æ‰Bç«™èµ„æºåŠ è½½é”™è¯¯å’ŒCORSé”™è¯¯ï¼Œè¿™äº›æ˜¯æ­£å¸¸çš„é™åˆ¶
                if (e.message && (
                    e.message.includes('MANIFEST') ||
                    e.message.includes('CORS') ||
                    e.message.includes('Failed to load resource') ||
                    e.message.includes('429') ||
                    e.message.includes('bili-user-fingerprint') ||
                    e.message.includes('StorageCache') ||
                    e.message.includes('Trigger perf bottleneck') ||
                    e.message.includes('cross-origin frame') ||
                    e.message.includes('Access-Control-Allow-Origin') ||
                    e.message.includes('XMLHttpRequest') ||
                    e.message.includes('Uncaught') ||
                    e.message.includes('core.6dcbfdb4.js')
                )) {
                    // å¿½ç•¥è¿™äº›é”™è¯¯ï¼Œä¸åšå¤„ç†
                    e.preventDefault();
                    return;
                }

                console.log('æ•è·åˆ°é”™è¯¯:', e.message);
            }, true);

            // æ‹¦æˆªç½‘ç»œè¯·æ±‚é”™è¯¯
            const originalFetch = window.fetch;
            window.fetch = function (...args) {
                return originalFetch.apply(this, args)
                    .catch(error => {
                        if (error && error.toString().includes('bili')) {
                            // é™é»˜å¤„ç†Bç«™ç›¸å…³é”™è¯¯
                            return Promise.reject(new Error('Silenced Bilibili API error'));
                        }
                        return Promise.reject(error);
                    });
            };

            // éšè—åŠ è½½åŠ¨ç”»
            setTimeout(() => {
                const loading = document.querySelector('.loading');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                }, 300);
            }, 600);
        });
    </script>
</body>

</html>